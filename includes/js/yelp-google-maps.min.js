function updateMap(a,b,c){"undefined"!=b&&handleResults(b,c)}function handleResults(a,b){if("undefined"!=typeof a.results[0].location)biz=a.results[0],createMarkerWidget(biz,new google.maps.LatLng(biz.location.coordinate.latitude,biz.location.coordinate.longitude),c,b);else if("undefined"!=typeof a.results[0].businesses)for(var c=0;c<a.results[0].businesses.length;c++)biz=a.results[0].businesses[c],bizAddress=biz.location.address[0]+", "+biz.location.city+", "+biz.location.state_code+", "+biz.location.country_code,"undefined"!=typeof biz.location.coordinate?createMarkerWidget(biz,new google.maps.LatLng(biz.location.coordinate.latitude,biz.location.coordinate.longitude),c,b):geocodeAddressWidget(bizAddress,c,b,biz);else console.log("Yelp Widget Pro Map Error: "+a.message.text)}function geocodeAddressWidget(a,b,c,d){geocoder.geocode({address:a},function(e,f){f===google.maps.GeocoderStatus.OK?createMarkerWidget(d,new google.maps.LatLng(e[0].geometry.location.ob,e[0].geometry.location.pb),b,c):f===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){geocodeAddressWidget(a,b,c,d)},200):console.log("Geocode was not successful for "+d.name+" the following reason: "+f)})}function createMarkerWidget(a,b,c,d){var e=new google.maps.Marker({map:d,icon:ywpParams.ywpURL+"/includes/images/marker_star.png",position:b});e.content=generateInfoWindowHtml(a),google.maps.event.addListener(e,"click",function(){infowindow.setContent(e.content),infowindow.open(d,e)})}function generateInfoWindowHtml(a){var b='<div class="marker">';return b+="undefined"!=typeof a.image_url?'<img class="businessimage" src="'+a.image_url+'"/>':'<img class="businessimage" src="'+ywpParams.ywpURL+'/includes/images/blank-biz.png"/>',b+='<div class="businessinfo">',b+='<a href="'+a.url+'" target="_blank" class="marker-business-name">'+a.name+"</a><br/>",b+='<img class="ratingsimage" src="'+a.rating_img_url_small+'"/>',b+=a.review_count+"&nbsp;reviews<br/>",b+=formatCategories(a.categories),a.location.neighborhoods&&(b+=formatNeighborhoods(a.location.neighborhoods)),b+=a.location.display_address+"<br/>",b+=a.location.city+",&nbsp;"+a.location.state_code+"&nbsp;"+a.location.postal_code+"<br/>",void 0!==a.phone&&(b+=formatPhoneNumber(a.phone)),b+='<br/><a href="'+a.url+'" target="_blank">Read the reviews &raquo;</a><br/>',b+="</div></div>"}function formatCategories(a){for(var b="Categories: ",c=0;c<a.length;c++)b+=a[c][0],c!=a.length-1&&(b+=", ");return b+="<br/>"}function formatNeighborhoods(a){s="Neighborhoods: ";for(var b=0;b<a.length;b++)s+=a[b],b!=a.length-1&&(s+=", ");return s+="<br/>"}function formatPhoneNumber(a){return 10!=a.length?"":"("+a.slice(0,3)+") "+a.slice(3,6)+"-"+a.slice(6,10)}jQuery(function(a){var b=a(".ywp-map");infowindow=new google.maps.InfoWindow,b.each(function(a){var c,d,e,f=JSON.parse(jQuery(b[a]).parent().attr("data-ywp-json"));geocoder=new google.maps.Geocoder;var g=jQuery(b[a]).parent().attr("data-map-scroll");g=void 0==g?!0:!1,"undefined"!=typeof f.results[0].region?e=new google.maps.LatLng(f.results[0].region.center.latitude,f.results[0].region.center.longitude):"undefined"!=typeof f.results[0].location.coordinate?e=new google.maps.LatLng(f.results[0].location.coordinate.latitude,f.results[0].location.coordinate.longitude):(bizAddress=f.results[0].location.address[0]+", "+f.results[0].location.city+", "+f.results[0].location.state_code+", "+f.results[0].location.country_code,geocoder.geocode({address:bizAddress},function(a,b){b==google.maps.GeocoderStatus.OK?e=new google.maps.LatLng(a[0].geometry.location.ob,a[0].geometry.location.pb):console.log("Geocode was not successful for the following reason: "+b)}));var h={scrollwheel:g,zoom:10,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};c=new google.maps.Map(b[a],h),google.maps.event.addDomListener(window,"load",function(){var a=c.getBounds();updateMap(a,f,c)}),d=new google.maps.InfoWindow({content:""}),jQuery(b[a]).parent().removeAttr("data-ywp-json")})});var jsonArray;