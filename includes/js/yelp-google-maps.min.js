function updateMap(a,b,c){"undefined"!=b&&handleResults(b,c)}function handleResults(a,b){if("undefined"!=typeof a.results[0].location)biz=a.results[0],bizAddress=biz.location.address[0]+", "+biz.location.city+", "+biz.location.state_code+", "+biz.location.country_code,geocodeAddressWidget(bizAddress,0,b,biz);else if("undefined"!=typeof a.results[0].businesses)for(var c=0;c<a.results[0].businesses.length;c++)biz=a.results[0].businesses[c],bizAddress=biz.location.address[0]+", "+biz.location.city+", "+biz.location.state_code+", "+biz.location.country_code,"undefined"!=typeof biz.location.coordinate?createMarkerWidget(biz,new google.maps.LatLng(biz.location.coordinate.latitude,biz.location.coordinate.longitude),b):geocodeAddressWidget(bizAddress,c,b,biz);else console.log("Yelp Widget Pro Map Error: "+a.message.text)}function geocodeAddressWidget(a,b,c,d){geocoder.geocode({address:a},function(e,f){f===google.maps.GeocoderStatus.OK?createMarkerWidget(d,new google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng()),c):f===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){geocodeAddressWidget(a,b,c,d)},200):console.log("Geocode was not successful for "+d.name+" the following reason: "+f)})}function createMarkerWidget(a,b,c){var d=new google.maps.Marker({map:c,icon:ywpParams.ywpURL+"/includes/images/marker_star.png",position:b});d.content=generateInfoWindowHtml(a),google.maps.event.addListener(d,"click",function(){infowindow.setContent(d.content),infowindow.open(c,d)})}function generateInfoWindowHtml(a){var b='<div class="marker">';return b+="undefined"!=typeof a.image_url?'<img class="businessimage" src="'+a.image_url+'" width="60" height="60"/>':'<img class="businessimage" src="'+ywpParams.ywpURL+'/includes/images/blank-biz.png" width="60" height="60"/>',b+='<div class="businessinfo">',b+='<a href="'+a.url+'" target="_blank" class="marker-business-name">'+a.name+"</a>",b+='<img class="ratingsimage" src="'+a.rating_img_url_small+'"/>',b+=a.review_count+"&nbsp;reviews<br/>",b+=formatCategories(a.categories),a.location.neighborhoods&&(b+=formatNeighborhoods(a.location.neighborhoods)),b+=a.location.display_address+"<br/>",b+=a.location.city+",&nbsp;"+a.location.state_code+"&nbsp;"+a.location.postal_code+"<br/>",void 0!==a.phone&&(b+=formatPhoneNumber(a.phone)),b+='<br/><a href="'+a.url+'" target="_blank" class="marker-reviews-link">Read the reviews &raquo;</a><br/>',b+="</div></div>"}function formatCategories(a){for(var b="Categories: ",c=0;c<a.length;c++)b+=a[c][0],c!=a.length-1&&(b+=", ");return b+="<br/>"}function formatNeighborhoods(a){s="Neighborhoods: ";for(var b=0;b<a.length;b++)s+=a[b],b!=a.length-1&&(s+=", ");return s+="<br/>"}function formatPhoneNumber(a){return 10!=a.length?"":"("+a.slice(0,3)+") "+a.slice(3,6)+"-"+a.slice(6,10)}var infowindow,geocoder;jQuery(function(a){var b=a(".ywp-map");b.each(function(a){var c,d=JSON.parse(jQuery(b[a]).parent().attr("data-ywp-json"));infowindow=new google.maps.InfoWindow,geocoder=new google.maps.Geocoder;var e=jQuery(b[a]).parent().attr("data-map-scroll");if(scrollOption=void 0==e?!0:!1,"undefined"!=typeof d.results[0].region){myLatLng=new google.maps.LatLng(d.results[0].region.center.latitude,d.results[0].region.center.longitude);var f={scrollwheel:scrollOption,zoom:10,center:myLatLng,mapTypeId:google.maps.MapTypeId.ROADMAP};c=new google.maps.Map(b[a],f),google.maps.event.addDomListener(c,"idle",function(){var a=c.getBounds();updateMap(a,d,c)})}else{var g=d.results[0].location.address[0]+", "+d.results[0].location.city+", "+d.results[0].location.state_code+", "+d.results[0].location.country_code;geocoder.geocode({address:g},function(e,f){if(f==google.maps.GeocoderStatus.OK){myLatLng=new google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng());var g={scrollwheel:scrollOption,zoom:10,center:myLatLng,mapTypeId:google.maps.MapTypeId.ROADMAP};c=new google.maps.Map(b[a],g),google.maps.event.addDomListener(c,"idle",function(){var a=c.getBounds();updateMap(a,d,c)})}else console.log("Geocode was not successful for the following reason: "+f)})}jQuery(b[a]).parent().removeAttr("data-ywp-json")})});var jsonArray;